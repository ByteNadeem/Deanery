{% load tailwind_tags %} {% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Deanery Project3</title>
        <link rel="apple-touch-icon" sizes="180x180" href={% static
        'apple-touch-icon.png' %} /> <link rel="icon" type="image/png"
        sizes="32x32" href={% static 'favicon-32x32.png' %} /> <link rel="icon"
        type="image/png" sizes="16x16" href={% static 'favicon-16x16.png' %} />
        {% comment %} <link rel="manifest" href="{% static 'site.webmanifest' %}" /> {% endcomment %}
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <link rel="stylesheet" href="{% static 'css/dist/output.css' %}" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        />
    </head>
    <body class="min-h-screen flex flex-col">
        <!-- Fixed Header/Navbar -->
        <header
            class="fixed top-0 left-0 w-full bg-neutral text-neutral-content shadow z-50 flex items-center justify-between px-6"
            style="height: 5rem"
        >
            <nav class="flex gap-6">
                <a
                    href="/"
                    class="bg-neutral rounded-lg px-4 py-2 shadow hover:bg-primary hover:text-white transition-colors max-h-[6rem] max-w-[6rem]"
                >
                    <img
                        src="{% static '/css/images/deanery_logo_crop.png' %}"
                        alt="Deanery Logo"
                    />
                </a>
            </nav>
            <nav class="flex gap-4">
                <a
                    href="{% url 'home' %}"
                    class="text-base font-medium text-neutral hover:text-primary bg-gray-100 rounded px-3 py-2 transition-colors hover:bg-primary hover:text-white"
                    >Home</a
                >
                <a
                    class="text-base font-medium text-neutral hover:text-primary bg-gray-100 rounded px-3 py-2 transition-colors hover:bg-primary hover:text-white"
                    href="{% url 'churches' %}"
                    >Our Churches</a
                >
                <a
                    href="{% url 'about' %}"
                    class="text-base font-medium text-neutral hover:text-primary bg-gray-100 rounded px-3 py-2 transition-colors hover:bg-primary hover:text-white"
                    >About</a
                >
                <a
                    href="{% url 'contact' %}"
                    class="text-base font-medium text-neutral hover:text-primary bg-gray-100 rounded px-3 py-2 transition-colors hover:bg-primary hover:text-white"
                    >Contact</a
                >
                <a
                    href="{% url 'map_home' %}"
                    class="text-base font-medium text-neutral hover:text-primary bg-gray-100 rounded px-3 py-2 transition-colors hover:bg-primary hover:text-white"
                    >Map</a
                >
            </nav>
        </header>

        <!-- Main Content -->
        <main class="flex-1" style="padding-bottom: 1rem">
            {% block content %}{% endblock %}
        </main>

        <!-- Fixed Footer -->
        <footer
            class="bottom-0 left-0 w-full bg-neutral text-neutral-content px-6 z-50"
            style="height: 10rem"
        >
            <div
                class="relative w-full h-full flex flex-col items-center justify-center"
            >
                <!-- Center socials and subscribe -->
                <div class="flex flex-col items-center justify-center">
                    <div
                        class="flex gap-6 items-center justify-center text-xl mb-4"
                    >
                        <a href="#" aria-label="Facebook"
                            ><i class="fab fa-facebook-f"></i
                        ></a>
                        <a href="#" aria-label="YouTube"
                            ><i class="fab fa-youtube"></i
                        ></a>
                        <a href="#" aria-label="Twitter"
                            ><i class="fab fa-twitter"></i
                        ></a>
                    </div>
                    <button
                        class="btn btn-primary btn-sm text-xs mt-2 sm:text-sm md:text-base whitespace-nowrap"
                        onclick="newsletter_modal.showModal()"
                    >
                        Subscribe to our Newsletter
                    </button>
                    <dialog
                        id="newsletter_modal"
                        class="modal modal-bottom sm:modal-middle"
                    >
                        <div class="modal-box">
                            <form method="dialog">
                                <button
                                    class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                                >
                                    âœ•
                                </button>
                            </form>
                            <h3 class="text-lg font-bold mb-4">
                                ðŸ“§ Stay Updated!
                            </h3>
                            <p class="py-4">
                                Get the latest news, events, and updates from
                                our deanery delivered to your inbox.
                            </p>
                            <form
                                method="post"
                                action="{% url 'newsletter_signup' %}"
                                id="newsletter-form"
                            >
                                {% csrf_token %}
                                <div class="form-control mb-4">
                                    <label class="label" for="first_name">
                                        <span class="label-text"
                                            >First Name *</span
                                        >
                                    </label>
                                    <input
                                        type="text"
                                        name="first_name"
                                        id="first_name"
                                        autocomplete="given-name"
                                        placeholder="First Name"
                                        class="input input-bordered w-full"
                                        required
                                    />
                                </div>
                                <div class="form-control mb-4">
                                    <label class="label" for="last_name">
                                        <span class="label-text"
                                            >Last Name *</span
                                        >
                                    </label>
                                    <input
                                        type="text"
                                        name="last_name"
                                        id="last_name"
                                        autocomplete="family-name"
                                        placeholder="Last Name"
                                        class="input input-bordered w-full"
                                        required
                                    />
                                </div>
                                <div class="form-control mb-4">
                                    <label class="label" for="email">
                                        <span class="label-text"
                                            >Email Address *</span
                                        >
                                    </label>
                                    <input
                                        type="email"
                                        name="email"
                                        id="email"
                                        autocomplete="email"
                                        placeholder="your.email@example.com"
                                        class="input input-bordered w-full"
                                        required
                                    />
                                </div>
                                <!-- GDPR Consent here -->
                                <div class="form-control mb-6">
                                    <label
                                        class="label cursor-pointer justify-start gap-3"
                                        for="consent"
                                    ></label>
                                    <input
                                        type="checkbox"
                                        class="checkbox checkbox-primary"
                                        name="consent"
                                        id="consent"
                                        autocomplete="off"
                                        required
                                    />
                                    <span class="label-text text-sm">
                                        I Consent to receive newsletter emails
                                        and understand I can unsubscribe at any
                                        time.
                                    </span>
                                    <a href="#" class="link">Privacy Policy</a>
                                </div>
                                <!-- Anti-bot honeypot here -->
                                <div style="diplay: none">
                                    <input
                                        type="text"
                                        name="website"
                                        tabindex="-1"
                                        autocomplete="off"
                                    />
                                </div>
                            </form>
                            <div class="modal-action">
                                <button
                                    type="button"
                                    class="btn"
                                    onclick="newsletter_modal.close()"
                                >
                                    Cancel Here
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Subscribe Here
                                </button>
                            </div>
                            <!-- Success/Error Message here -->
                            <div id="form-messages" class="mt-4"></div>
                        </div>
                    </dialog>
                </div>
                <!-- Copyright bottom right -->
                <div class="absolute bottom-2 right-6">
                    <p class="m-0 text-sm">
                        &copy; {% now 'Y' %} - All rights reserved
                    </p>
                </div>
            </div>
        </footer>

        {% block extra_js %}{% endblock %}
        <!-- Newsletter Form script here -->
        <script>
            document
                .getElementById("newsletter-form")
                .addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const formData = new FormData(this);
                    const messageDiv = document.getElementById("form-messages");

                    // Basic anti-bot check
                    if (formData.get("website")) {
                        return; // Bot detected
                    }

                    try {
                        const response = await fetch(
                            '{% url "newsletter_signup" %}',
                            {
                                method: "POST",
                                body: formData,
                                headers: {
                                    "X-CSRFToken": document.querySelector(
                                        "[name=csrfmiddlewaretoken]"
                                    ).value,
                                },
                            }
                        );

                        const data = await response.json();

                        if (data.success) {
                            messageDiv.innerHTML = `
                        <div class="alert alert-success">
                            <span> ${data.message}</span>
                        </div>
                    `;
                            this.reset();
                            setTimeout(() => {
                                newsletter_modal.close();
                            }, 2000);
                        } else {
                            messageDiv.innerHTML = `
                        <div class="alert alert-error">
                            <span> ${data.message}</span>
                        </div>
                    `;
                        }
                    } catch (error) {
                        messageDiv.innerHTML = `
                    <div class="alert alert-error">
                        <span> Something went wrong. Please try again.</span>
                    </div>
                `;
                    }
                });
        </script>
        <!-- Font Awesome CDN for icons -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
